/**
 * Created by askrypai on 11/23/16.
 */

const NEWS = [
    {
        "_id": "5835c2926344e46f1be30774",
        "index": 0,
        "picture": "http://lorempixel.com/120/120/sport/5",
        "title": "Brown Lawrence",
        "text": "4Lorem eu sit anim nulla dolore ea aliqua non enim cupidatat adipisicing consectetur anim consequat cillum adipisicing labore eu elit",
        "color": "brown"
    },
    {
        "_id": "5835c292f5dd148ad225930b",
        "index": 1,
        "picture": "http://lorempixel.com/120/120/sport/2",
        "title": "Janna Irwin",
        "text": "5sunt est velit qui excepteur dolore fugiat cillum deserunt adipisicing cupidatat aliqua labore incididunt nostrud tempor cupidatat sunt quis amet",
        "color": "orange"
    },
    {
        "_id": "5835c29294796e01af0d2c3c",
        "index": 2,
        "picture": "http://lorempixel.com/120/120/sport/6",
        "title": "Lester Langley",
        "text": "5reprehenderit dolor aliquip id tempor ex et veniam incididunt amet ex in dolore elit anim deserunt mollit fugiat elit elit",
        "color": "sienna"
    },
    {
        "_id": "5835c2925b28a4ee67945ac5",
        "index": 3,
        "picture": "http://lorempixel.com/120/120/sport/10",
        "title": "Norma Bowers",
        "text": "4est velit pariatur aliqua non commodo ipsum laboris pariatur officia aliqua non commodo excepteur ut reprehenderit ut eu cupidatat Lorem",
        "color": "royalblue"
    },
    {
        "_id": "5835c2924417e213820ccdd9",
        "index": 4,
        "picture": "http://lorempixel.com/120/120/sport/1",
        "title": "Gale Peters",
        "text": "3excepteur commodo laborum esse mollit ullamco nisi sint fugiat duis aute consectetur excepteur laboris ipsum officia tempor veniam in minim",
        "color": "crimson"
    },
    {
        "_id": "5835c292993ea2f993c498a1",
        "index": 5,
        "picture": "http://lorempixel.com/120/120/sport/6",
        "title": "Ryan Fleming",
        "text": "6ea dolor incididunt enim laboris eiusmod velit pariatur aute minim id incididunt quis nostrud labore commodo consectetur qui incididunt cupidatat",
        "color": "green"
    },
    {
        "_id": "5835c2926c6104c94a529a27",
        "index": 6,
        "picture": "http://lorempixel.com/120/120/sport/2",
        "title": "Kate Daniel",
        "text": "9magna amet qui aliquip est qui ipsum sunt irure excepteur ipsum dolore occaecat veniam laboris ut consectetur ex minim ex",
        "color": "brown"
    },
    {
        "_id": "5835c2926ca2d7181e430eaf",
        "index": 7,
        "picture": "http://lorempixel.com/120/120/sport/5",
        "title": "Solomon Hendricks",
        "text": "3minim esse ipsum Lorem id ut consectetur nisi aliqua laboris est nostrud proident voluptate dolore labore mollit aute est Lorem",
        "color": "sienna"
    },
    {
        "_id": "5835c292e5db387b6cd7a10c",
        "index": 8,
        "picture": "http://lorempixel.com/120/120/sport/1",
        "title": "Cooper Donaldson",
        "text": "8nisi est amet ullamco duis consectetur ut laboris quis Lorem sunt dolor aute quis amet reprehenderit dolore labore dolor officia",
        "color": "green"
    },
    {
        "_id": "5835c292ca8eeec3483b3e2c",
        "index": 9,
        "picture": "http://lorempixel.com/120/120/sport/1",
        "title": "Boyd Clay",
        "text": "6deserunt non qui nulla non est ut et cupidatat esse nisi voluptate voluptate culpa adipisicing minim nulla labore irure pariatur",
        "color": "sienna"
    },
    {
        "_id": "5835c2929c992b035782619d",
        "index": 10,
        "picture": "http://lorempixel.com/120/120/sport/1",
        "title": "Marguerite Cotton",
        "text": "4ex nulla non sunt non deserunt in eiusmod proident sint eiusmod deserunt excepteur voluptate sint culpa officia magna officia tempor",
        "color": "blue"
    },
    {
        "_id": "5835c2928b3a1ce36c127241",
        "index": 11,
        "picture": "http://lorempixel.com/120/120/sport/3",
        "title": "Tara Warner",
        "text": "6sit consequat magna commodo anim reprehenderit nisi ipsum mollit officia incididunt elit do commodo cillum ex officia deserunt incididunt qui",
        "color": "green"
    },
    {
        "_id": "5835c292e422931b45c94f0a",
        "index": 12,
        "picture": "http://lorempixel.com/120/120/sport/9",
        "title": "Kristin Johns",
        "text": "3fugiat non aliqua adipisicing consectetur magna ad dolor et duis culpa consequat ullamco officia eiusmod eiusmod ipsum exercitation sint enim",
        "color": "orange"
    },
    {
        "_id": "5835c2924cea03cc257a68cb",
        "index": 13,
        "picture": "http://lorempixel.com/120/120/sport/2",
        "title": "Lorraine Bonner",
        "text": "4ad sint minim mollit veniam reprehenderit nulla consequat labore quis ea fugiat minim consectetur cupidatat aliquip excepteur consequat et excepteur",
        "color": "brown"
    },
    {
        "_id": "5835c2920e06c3ea38132804",
        "index": 14,
        "picture": "http://lorempixel.com/120/120/sport/7",
        "title": "Earlene Walters",
        "text": "9ut nostrud quis aliquip ut ipsum consequat velit proident veniam adipisicing magna voluptate ex eu irure reprehenderit aliquip aliqua reprehenderit",
        "color": "brown"
    },
    {
        "_id": "5835c2925c97b7fc54dca85e",
        "index": 15,
        "picture": "http://lorempixel.com/120/120/sport/8",
        "title": "Decker Russell",
        "text": "2do Lorem ad irure ipsum minim enim commodo elit qui Lorem ut enim occaecat incididunt ipsum laborum consectetur deserunt eu",
        "color": "sienna"
    },
    {
        "_id": "5835c29226132b656706d74b",
        "index": 16,
        "picture": "http://lorempixel.com/120/120/sport/2",
        "title": "Ochoa Odom",
        "text": "6fugiat sit pariatur qui tempor commodo in velit dolor laborum ad enim fugiat nulla magna nostrud qui reprehenderit cupidatat proident",
        "color": "orange"
    },
    {
        "_id": "5835c292743b7c2de8ff0b41",
        "index": 17,
        "picture": "http://lorempixel.com/120/120/sport/9",
        "title": "Whitfield Clements",
        "text": "4Lorem sunt irure duis minim nulla ipsum aute pariatur non sit laboris id proident Lorem ea nostrud dolor tempor in",
        "color": "royalblue"
    }
];

var Note = React.createClass({

    render: function () {

        var style = {backgroundColor: this.props.color};

        return (
            <div className="notes__note" style={style}>
                <span className="notes__delete" onClick={this.props.onDelete}>X</span>
                <h3 className="notes__title">{this.props.title}</h3>
                <div className="notes__body">{this.props.children}</div>
            </div>
        );
    }
});

var NoteEditor = React.createClass({
    getInitialState: function () {
        return {
            text: '',
            title: ''
        }
    },
    onChangeTitleHandler: function (event) {
        this.setState({
            title: event.target.value
        });
    },
    onChangeTextHandler: function (event) {
        this.setState({
            text: event.target.value
        });
    },
    addNoteHandler: function () {

        this.props.onNoteAdd({
            text: this.state.text,
            title: this.state.title,
            color: 'yellow',
            _id: Date.now()
        });

        this.setState({ text: '', title: '' });
    },
    render: function () {
        return (
            <div className="notes__editor">
                <div>
                    <input className="notes__inputTitle" placeholder="Enter your note title here..." type="text" value={this.state.title} onChange={this.onChangeTitleHandler}/>
                 </div>
                <div>
                    <textarea className="notes__inputText" placeholder="Enter your note here..." rows={5} value={this.state.text} onChange={this.onChangeTextHandler}/>
                </div>
                <div className="notes__right">
                    <buttin type="button" className="notes__add" onClick={this.addNoteHandler}>Add</buttin>
                </div>

            </div>
        );
   }
});

var NotesGrid = React.createClass({
    componentDidMount: function () {
        this.msnry = new Masonry( this.refs.msnry, {
            columnWidth: 200,
            itemSelector: '.notes__note',
            gutter: 20,
            isFitWidth: true
        });
    },
    componentDidUpdate: function (prevProps) {
        if (this.props.notes.length !== prevProps.notes.length) {
            this.msnry.reloadItems();
            this.msnry.layout();
        }
    },
    render: function () {
        var notesDeleteHandler = this.props.onNoteDelete;
        return (

            <div className="notes__grid" ref="msnry">
                {
                    this.props.notes.map(function(note){
                       return <Note key={note._id} color={note.color} title={note.title} onDelete={notesDeleteHandler.bind(null, note)}>{note.text} </Note>;
                    })
                }
            </div>
        )
    }
});

var NotesApp = React.createClass({
    getInitialState: function () {
      return {
          notes: []
      }

    },
    handleNoteAdd: function (newNote) {
        var newNotes = this.state.notes.slice();
        newNotes.unshift(newNote);
        this.setState({
            notes: newNotes
        });
    },
    componentDidMount: function () {

        var localNotes = JSON.parse(localStorage.getItem('notes'));
        localNotes = localNotes.concat(NEWS);
        if (localNotes) {
            this.setState({
                notes: localNotes
            })
        }
    },
    componentDidUpdate: function () {
        this._updateLocalStorage();
    },
    _updateLocalStorage: function () {
        var notes = JSON.stringify(this.state.notes);
        localStorage.setItem('notes', notes);
    },
    handleNoteDelete: function (note) {
        var id = note._id;
        var newNotes = this.state.notes.filter(function(item){
            return item._id !== id;
        });
        this.setState({
            notes: newNotes
        })
    },
    render: function () {
        return (
            <div className="notes">
                <h2 className="notes_header">Notes App</h2>
                <NoteEditor onNoteAdd={this.handleNoteAdd}/>
                <NotesGrid notes={this.state.notes} onNoteDelete={this.handleNoteDelete}/>
            </div>
        )
    }
});

ReactDOM.render(
    <NotesApp/>,
    document.getElementById('content')
);